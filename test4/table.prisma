//表结构视图 https://prisma-editor.bahumaish.com/schema/17244
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./sqlite.db"
}

// 1. 用户表
model sys_user {
  id       String  @id @default(uuid())
  phone    String  @unique
  password String  @default("123456")
  name     String
  remark   String?
}

// 2. 组织表
model sys_depart {
  id        String       @id @default(uuid())
  name      String
  remark    String?
  parent_id String? //自关联
  is_depart Boolean      @default(true) //是否是组织
  parent    sys_depart?  @relation("self_sys_depart", fields: [parent_id], references: [id])
  children  sys_depart[] @relation("self_sys_depart")

  //基本数据如下
  // 客户部
  //    - 客户普通  可以看到菜单  首页
  //    - 客户高级  可以看到菜单  首页
  // 技术部
  //    - 技术职员  可以看到菜单                    系统设置一组织人员  商城管理一订单管理  商城管理一商品管理  商城管理一财务管理
  //    - 技术主管  可以看到菜单  系统设置一组织管理  系统设置一组织人员  商城管理一订单管理  商城管理一商品管理  商城管理一财务管理
  // 财务部
  //    - 财务职员  可以看到菜单                                        商城管理一订单管理                    商城管理一财务管理
  //    - 财务主管  可以看到菜单                    系统设置一组织人员   商城管理一订单管理  商城管理一商品管理  商城管理一财务管理
}

// 3 .菜单表
model sys_menu {
  id        String     @id @default(uuid())
  name      String
  path      String?
  remark    String?
  parent_id String? //自关联
  parent    sys_menu?  @relation("self_sys_menu", fields: [parent_id], references: [id])
  children  sys_menu[] @relation("self_sys_menu")

  //基本数据如下
  // 首页
  // 系统设置
  //     - 组织人员
  //     - 组织管理
  // 商城管理
  //     - 订单管理
  //     - 商品管理
  //     - 财务管理
}

// // 使用CTE递归查询组织层级
// async function getOrgHierarchyWithSQL(orgId: string) {
//   const result = await prisma.$queryRaw`
//     WITH RECURSIVE org_hierarchy AS (
//       -- 基础查询：起始组织
//       SELECT id, name, parent_id, 0 as level
//       FROM sys_org 
//       WHERE id = ${orgId}

//       UNION ALL

//       -- 递归查询：父级组织
//       SELECT o.id, o.name, o.parent_id, oh.level + 1
//       FROM sys_org o
//       INNER JOIN org_hierarchy oh ON o.id = oh.parent_id
//     )
//     SELECT * FROM org_hierarchy 
//     ORDER BY level DESC
//   `;

//   return result;
// }
